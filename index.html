<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºë¦¬ë§ˆí… ë ˆì§„ ë¬¼ì„± ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'carimatech-resin-guide';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.db = db;
        window.appId = appId;
        window.currentUser = null;

        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                console.error("Firebase ì¸ì¦ ì‹¤íŒ¨:", err);
            }
        };

        onAuthStateChanged(auth, (user) => {
            window.currentUser = user;
            if (user) {
                window.loadResinData();
            }
        });

        initAuth();

        const colorThemes = {
            blue: { color: 'bg-blue-50', border: 'border-blue-800', text: 'text-blue-900', tagColor: 'bg-blue-200', tableClass: 'bg-blue-100', borderColor: '#1e3a8a' },
            orange: { color: 'bg-orange-50', border: 'border-orange-600', text: 'text-orange-800', tagColor: 'bg-orange-200', tableClass: 'bg-orange-100', borderColor: '#ea580c' },
            green: { color: 'bg-green-50', border: 'border-green-700', text: 'text-green-800', tagColor: 'bg-green-200', tableClass: 'bg-green-100', borderColor: '#15803d' },
            yellow: { color: 'bg-yellow-50', border: 'border-yellow-500', text: 'text-yellow-800', tagColor: 'bg-yellow-200', tableClass: 'bg-yellow-100', borderColor: '#ca8a04' },
            sky: { color: 'bg-sky-50', border: 'border-sky-500', text: 'text-sky-800', tagColor: 'bg-sky-200', tableClass: 'bg-sky-100', borderColor: '#0ea5e9' },
            pink: { color: 'bg-pink-50', border: 'border-pink-500', text: 'text-pink-800', tagColor: 'bg-pink-200', tableClass: 'bg-pink-100', borderColor: '#db2777' },
            slate: { color: 'bg-slate-50', border: 'border-slate-800', text: 'text-slate-900', tagColor: 'bg-slate-200', tableClass: 'bg-slate-100', borderColor: '#475569' },
            indigo: { color: 'bg-indigo-50', border: 'border-indigo-800', text: 'text-indigo-900', tagColor: 'bg-indigo-200', tableClass: 'bg-indigo-100', borderColor: '#4f46e5' },
            teal: { color: 'bg-teal-50', border: 'border-teal-800', text: 'text-teal-900', tagColor: 'bg-teal-200', tableClass: 'bg-teal-100', borderColor: '#0d9488' },
            rose: { color: 'bg-rose-50', border: 'border-rose-800', text: 'text-rose-900', tagColor: 'bg-rose-200', tableClass: 'bg-rose-100', borderColor: '#e11d48' }
        };

        const defaultResinData = {
            engineering: {
                rigid: { idx: 0, zoomMax: 10, title: 'Rigid V2 Black', tag: 'ê³ ê°•ì„±/ì •ì ëª¨ë¸', ...colorThemes.blue, features: 'Â· Tough ë¼ì¸ì—… ëŒ€ë¹„ ì›”ë“±íˆ ë†’ì€ ê°•ì„±\nÂ· ì™¸ë¶€ í˜ì— ì˜í•œ ë³€í˜•ì´ ê±°ì˜ ì—†ëŠ” ë‹¨ë‹¨í•¨\nÂ· ì¹˜ìˆ˜ ì•ˆì •ì„±ì´ ì¤‘ìš”í•œ ì •ì  ëª¨ë¸ë§ì— ìµœì í™”', apps: 'ì •ì  ì „ì‹œ ëª¨ë¸, ê²€ì‚¬ìš© ì§€ê·¸(Jig), í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜, ì •ë°€ ê°€ê³µí’ˆ ì¼€ì´ìŠ¤.', stats: { visc: '2822', modulus: '2859', strength: '80.8', elongation: '6.4', impact: '41.5', hardness: '74.5D' }, chart: [{x: 0, y: 0}, {x: 2, y: 60}, {x: 4, y: 82}, {x: 6.4, y: 80.8}] },
                toughi: { idx: 1, zoomMax: 20, title: 'Tough V2 I Black', tag: 'ê°•ë„/ë‚´ì¶©ê²©', ...colorThemes.orange, features: 'Â· íƒ€ ë ˆì§„ ëŒ€ë¹„ ë†’ì€ ê°•ì„± ë° ê°•ë„\nÂ· ì ì€ ìˆ˜ì¶•ìœ¼ë¡œ ì˜ íœ˜ì§€ ì•ŠëŠ” ì„±ì§ˆ\nÂ· ë‹¨ë‹¨í•˜ê³  ì¶©ê²©ì— ê°•í•œ ëª¨ë¸ë§ ì¶œë ¥ì— ì í•©', apps: 'ê¸°ëŠ¥ì„± ì‹œì œí’ˆ, ì¸í´ë¡œì €(ì™¸í•¨), ë³´í˜¸ìš© ì»¤ë²„, ì¶©ê²© í•˜ì¤‘ì„ ë°›ëŠ” ë¶€í’ˆ.', stats: { visc: '1000', modulus: '2155', strength: '71.5', elongation: '10.4', impact: '43.7', hardness: '61.0D' }, chart: [{x: 0, y: 0}, {x: 3, y: 55}, {x: 6, y: 72}, {x: 10.4, y: 50}] },
                toughe: { idx: 2, zoomMax: 120, title: 'Tough V2 E Black', tag: 'ìœ ì—°/ë‚´êµ¬ì„±', ...colorThemes.green, features: 'Â· PP ì†Œì¬ì™€ ìœ ì‚¬í•œ ë†’ì€ ìœ ì—°ì„± ë° ë‚´êµ¬ì„±\nÂ· ë°˜ë³µì ì¸ êµ¬ë™ì´ë‚˜ êµ¬ë¶€ë¦¼ì—ë„ íŒŒì†ë˜ì§€ ì•ŠëŠ” íŠ¹ì„±\nÂ· ìœ ì—°í•˜ê³  ë°˜ë³µì ì¸ ì²´ê²°ì´ í•„ìš”í•œ ëª¨ë¸ë§ì— ì í•©', apps: 'ë¦¬ë¹™ íŒì§€(Living Hinges), ìŠ¤ëƒ…í• ì¡°ì¸íŠ¸, ë°˜ë³µ ì²´ê²°ìš© í´ë¦½, ê°€ë™ì„± ì‹œì œí’ˆ.', stats: { visc: '700', modulus: '984', strength: '34.5', elongation: '100.6', impact: '76.1', hardness: '56.5D' }, chart: [{x: 0, y: 0}, {x: 10, y: 35}, {x: 60, y: 28}, {x: 100.6, y: 34.5}] },
                hard21: { idx: 3, zoomMax: 5, title: 'HARD21 Yellowish', tag: 'ì´ˆê³ ê°•ë„/ê³ ì •ë°€', ...colorThemes.yellow, features: 'Â· ê³ ê°•ë„ì˜ ì†Œì¬ë¡œ ì™¸ë¶€ì˜ í˜ì— ë‚®ì€ ë³€í˜•ë¥ \nÂ· ë¹ ë¥¸ ì¶œë ¥ ì‹œê°„', apps: 'ì†Œí˜• ì •ë°€ ê¸°ì–´, ê¸ˆì† ì‚½ì…(Insert) í•˜ìš°ì§•, ê³ ë¶€í•˜ë¥¼ ê²¬ë””ëŠ” ë¸Œë¼ì¼“, ê¸°ê³„ ì‘ë™ ë¶€í’ˆ.', stats: { visc: '200', modulus: '4200', strength: '92', elongation: '2.8', impact: '-', hardness: '86D' }, chart: [{x: 0, y: 0}, {x: 1.5, y: 50}, {x: 2.8, y: 92.0}] },
                elasto70: { idx: 4, zoomMax: 300, title: 'Elasto 70 Black', tag: 'ê³ íƒ„ì„±/ì €ê²½ë„', ...colorThemes.sky, features: 'Â· ê³ ë¬´ì™€ ê°™ì€ ë†’ì€ íƒ„ì„±ê³¼ ìœ ì—°ì„±\nÂ· ìš°ìˆ˜í•œ ì¶©ê²© í¡ìˆ˜ìœ¨ê³¼ ë¯¸ë„ëŸ¼ ë°©ì§€ íŠ¹ì„±\nÂ· ë†’ì€ íŒŒë‹¨ ì—°ì‹ ìœ¨', apps: 'ê°€ìŠ¤ì¼“, ì”°(Seal), ì™„ì¶©ìš© íŒ¨ë“œ, ë¯¸ë„ëŸ¼ ë°©ì§€ ë°œíŒ, ì§„ë™ ê°ì‡„ìš© ë¶€í’ˆ.', stats: { visc: '5000', modulus: '40', strength: '6.6', elongation: '222.7', impact: '-', hardness: '78A' }, chart: [{x: 0, y: 0}, {x: 100, y: 5}, {x: 222.7, y: 6.6}] },
                elasto85: { idx: 5, zoomMax: 300, title: 'Elasto 85 Black', tag: 'ê³ íƒ„ì„±/ë‚´ë§ˆëª¨', ...colorThemes.pink, features: 'Â· Elasto70 ëŒ€ë¹„ ë†’ì€ ê²½ë„ì™€ ì¸ì—´ê°•ë„\nÂ· 1ì•¡í˜• ì†Œì¬ì„ì—ë„ ë§¤ìš° ë†’ì€ ê¸°ê³„ì  ë¬¼ì„± êµ¬í˜„', apps: 'ì‹ ë°œ ë°‘ì°½(Outsole), ê³ ê°•ë„ í•¸ë“¤ ê·¸ë¦½, ì‚°ì—…ìš© íŠœë¸Œ, ê³ ë‚´êµ¬ íƒ„ì„± ì›¨ì–´ëŸ¬ë¸”.', stats: { visc: '5000', modulus: '58', strength: '8.0', elongation: '287.0', impact: '-', hardness: '85.5A' }, chart: [{x: 0, y: 0}, {x: 100, y: 6}, {x: 287, y: 8.0}] }
            },
            functional: {
                fr: { idx: 0, zoomMax: 25, title: 'Flame Retardant', tag: 'ë‚œì—°/ë‚´ì¶©ê²©', ...colorThemes.indigo, features: 'Â· í™”ì¬ ë°œìƒ ì‹œ ë¶ˆì˜ í™•ì‚°ì„ ì–µì œí•˜ëŠ” íƒì›”í•œ ë‚œì—° ì„±ëŠ¥\nÂ· ê°•í•œ ê°•ë„ì™€ ë‚´ì¶©ê²©ì„±ì„ ê²¸ë¹„í•˜ì—¬ ì™¸ë¶€ ì¶©ê²©ì— ì‰½ê²Œ íŒŒì†ë˜ì§€ ì•ŠìŒ\nÂ· ì „ì, ìë™ì°¨ ë“± ìµœê³  ìˆ˜ì¤€ì˜ ì•ˆì „ê³¼ ë‚´êµ¬ì„±ì´ ìš”êµ¬ë˜ëŠ” ë¶€í’ˆ ì œì‘ì— ìµœì í™”', apps: 'ë°°í„°ë¦¬ ê´€ë ¨ ë¶€í’ˆ, ë‚´/ì™¸ì¥ì¬, ì¥ë¹„ ì»¤ë²„, ì§€ê·¸ ë° ê³ ì •êµ¬.', stats: { visc: '2400', modulus: '1265', strength: '38.7', elongation: '18.4', impact: 'ê°•í•¨', hardness: '79.5D' }, chart: [{x:0, y:0}, {x:8, y:25}, {x:18.4, y:38.7}] },
                prof_gray: { idx: 1, zoomMax: 10, title: 'Professional Gray', tag: 'ê³ ì†ì¶œë ¥/ë§¤íŠ¸', ...colorThemes.slate, features: 'Â· ë¹ ë¥¸ ì¶œë ¥ ì†ë„ ì œê³µ\nÂ· ì´‰ê° ë° ì‹œê°ì  ë¶€ë“œëŸ¬ìš´ ì§ˆê° í‘œí˜„\nÂ· ë§¤íŠ¸í•¨ê³¼ ê´‘íƒì´ ê³µì¡´í•˜ëŠ” ë§¤ë ¥ì ì¸ ì†Œì¬', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬, ì „ê¸°ì „ìë¶€í’ˆ.', stats: { visc: '180', modulus: '1700', strength: '55', elongation: '4', impact: '-', hardness: '82D' }, chart: [{x:0, y:0}, {x:2, y:40}, {x:4, y:55}] },
                pro_htr: { idx: 2, zoomMax: 5, title: 'Pro HTR', tag: 'ì´ˆê³ ë‚´ì—´ (270â„ƒ)', ...colorThemes.yellow, features: 'Â· ë†’ì€ ê²½ë„ì™€ ì¸ì¥ê°•ë„\nÂ· 270Â°C ì´ìƒì˜ ê³ ë‚´ì—´ ì†Œì¬\nÂ· ê³ ì˜¨ ê³µì •ì— ì‚¬ìš©í•˜ëŠ” ì‚°ì—…ìš© ë¶€í’ˆ ì¶œë ¥ì— ì í•© (ex. ì§€ê·¸, ëª°ë”© ë“±)', apps: 'ì†Œë¹„ì¬, ì‚°ì—…ìš©, ìë™ì°¨, ìš°ì£¼/í•­ê³µ, ì „ê¸°ì „ìë¶€í’ˆ.', stats: { visc: '1622', modulus: '3200', strength: '56', elongation: '1', impact: '-', hardness: '90D' }, chart: [{x:0, y:0}, {x:0.5, y:40}, {x:1, y:56}] },
                micro150: { idx: 3, zoomMax: 15, title: 'Micro 150', tag: 'ì •ë°€/íˆ¬ëª…', ...colorThemes.sky, features: 'Â· 385nm 3Dìš© íˆ¬ëª…í•œ ì†Œì¬\nÂ· ìš°ìˆ˜í•œ ì •ë°€ë„\nÂ· Micro fluidic Channel êµ¬í˜„ ì í•© Device', apps: 'ì—°êµ¬ ë° ê°œë°œ(R&D).', stats: { visc: '250', modulus: '1800', strength: '40', elongation: '10', impact: '-', hardness: '83D' }, chart: [{x:0, y:0}, {x:5, y:30}, {x:10, y:40}] }
            },
            general: {
                cmyk: { idx: 0, zoomMax: 10, title: 'ë¬´ë…ì„± CMYK', tag: 'ì¹œí™˜ê²½/ì €ì ë„', ...colorThemes.teal, desc: 'ìºë¦¬ë§ˆí…ì—ì„œ ìì²´ ê°œë°œí•œ ì¹œí™˜ê²½ ì†Œì¬ë¡œ í”¼ë¶€ ë¹„ìê·¹, ë¬´ë…ì„± ë° ë¬´ì·¨ì˜ ì•ˆì „í•œ ì†Œì¬', features: 'Â· 6ê°€ì§€ ìƒ‰ìƒìœ¼ë¡œ ë‹¤ì–‘í•œ ìƒ‰ìƒ ë°°í•© ê°€ëŠ¥\nÂ· ììœ ë¡­ê²Œ í˜¼í•©í•˜ì—¬ ì‚¬ìš©í•˜ë”ë¼ë„ ë³€í•¨ì—†ëŠ” ì¶œë ¥ íŒŒë¼ë¯¸í„° ê°’\nÂ· ì €ì ë„ë¡œ ë‚¨ë…€ë…¸ì†Œ ëˆ„êµ¬ë‚˜ ì‰½ê²Œ ì‚¬ìš©', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬.', stats: { visc: '350', modulus: '2300', strength: '50', elongation: '4', impact: '-', hardness: '84D' }, chart: [{x:0, y:0}, {x:2, y:40}, {x:4, y:50}] },
                std_black: { idx: 1, zoomMax: 10, title: 'Standard Black', tag: 'í‘œì¤€í˜•/ë‹¨ë‹¨í•¨', ...colorThemes.slate, features: 'Â· ì—í­ì‹œ ê¸°ë°˜ì˜ ë¬¼ì„±ìœ¼ë¡œ ë¹„êµì  ê²¬ê³ í•˜ë©° ë‹¨ë‹¨í•¨\nÂ· ë§¤ë„ëŸ¬ìš´ í‘œë©´ ë§ˆê°\nÂ· ì´ˆë³´ìë“¤ë„ ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ ì†Œì¬\nÂ· ì¶œë ¥ ì‹œê°„ì´ íƒ€ ì†Œì¬ ëŒ€ë¹„ ë‹¨ì¶•', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬.', stats: { visc: '120', modulus: '2700', strength: '84', elongation: '4', impact: '-', hardness: '87D' }, chart: [{x:0, y:0}, {x:2, y:60}, {x:4, y:84}] },
                fig_gray: { idx: 2, zoomMax: 10, title: 'Figure Gray', tag: 'ê³ ì •ë°€/ì´ˆë³´ììš©', ...colorThemes.indigo, features: 'Â· ë†’ì€ ì •ë°€ë„ì™€ í‘œë©´ì¡°ë„ë¡œ ì´ˆë³´ìë“¤ë„ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥\nÂ· ì¶œë ¥ ì‹œ ì†ìƒì—†ì´ ì„œí¬íŠ¸ ì œê±°ì™€ ì¡°í˜•íŒê³¼ ì¶œë ¥ë¬¼ì„ ì‰½ê²Œ ë¶„ë¦¬', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬.', stats: { visc: '240', modulus: '2200', strength: '79', elongation: '5', impact: '-', hardness: '85D' }, chart: [{x:0, y:0}, {x:2.5, y:55}, {x:5, y:79}] },
                fig_beige: { idx: 3, zoomMax: 10, title: 'Figure Beige', tag: 'ê³ ì •ë°€/ê³ ê°•ì„±', ...colorThemes.orange, features: 'Â· ë†’ì€ ì •ë°€ë„ì™€ í‘œë©´ì¡°ë„ë¡œ ì´ˆë³´ìë“¤ë„ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥\nÂ· ì¶œë ¥ ì‹œ ì†ìƒì—†ì´ ì„œí¬íŠ¸ ì œê±°ì™€ ì¡°í˜•íŒê³¼ ì¶œë ¥ë¬¼ì„ ì‰½ê²Œ ë¶„ë¦¬', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬.', stats: { visc: '360', modulus: '3000', strength: '64', elongation: '5', impact: '-', hardness: '85D' }, chart: [{x:0, y:0}, {x:2.5, y:45}, {x:5, y:64}] },
                matt_white: { idx: 4, zoomMax: 15, title: 'Matt White', tag: 'ë¬´ê´‘/ê³ ì†ì¶œë ¥', ...colorThemes.slate, features: 'Â· ë¹ ë¥¸ ì¶œë ¥ ì†ë„ ì œê³µ\nÂ· ì´‰ê° ë° ì‹œê°ì  ë¶€ë“œëŸ¬ìš´ ì§ˆê° í‘œí˜„\nÂ· ë³€í•˜ì§€ ì•ŠëŠ” ìƒ‰ìƒìœ¼ë¡œ í°ìƒ‰ì˜ ë¬´ê´‘íƒ ì†Œì¬', apps: 'êµìœ¡ìš©, í”¼ê·œì–´/ì¥ë‚œê°, R&D, ì†Œë¹„ì¬.', stats: { visc: '312', modulus: '1200', strength: '53', elongation: '6', impact: '-', hardness: '83D' }, chart: [{x:0, y:0}, {x:3, y:40}, {x:6, y:53}] }
            }
        };

        window.loadResinData = async () => {
            const docRef = doc(window.db, 'artifacts', window.appId, 'public', 'data', 'resins', 'master');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    window.resinData = docSnap.data().data;
                } else {
                    window.resinData = defaultResinData;
                    window.saveToFirestore();
                }
                window.renderSystem();
                if (window.lockedMaterialId) window.updateMaterialUI(window.lockedMaterialId);
            });
        };

        window.saveToFirestore = async () => {
            if (!window.currentUser) return;
            const docRef = doc(window.db, 'artifacts', window.appId, 'public', 'data', 'resins', 'master');
            try { 
                await setDoc(docRef, { data: window.resinData }); 
                window.showMessage("ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); 
            } catch (e) { console.error(e); }
        };

        window.renderSystem = () => {
            const catData = window.resinData[window.currentCategory] || {};
            const sortedIds = Object.keys(catData).sort((a,b)=>catData[a].idx-catData[b].idx);
            const btnContainer = document.getElementById('material-btns-container');
            const tableHead = document.getElementById('table-head');
            const tableBody = document.getElementById('table-body');
            if (!btnContainer || !tableHead || !tableBody) return;

            btnContainer.innerHTML = '';
            sortedIds.forEach(id => {
                const mat = catData[id];
                const btn = document.createElement('button');
                btn.id = `btn-${id}`;
                btn.className = `material-btn py-3 px-1 text-[11px] font-bold rounded-lg border ${mat.border?.replace('border-', 'border-opacity-20 ') || 'border-slate-200'} ${mat.color || 'bg-white'} ${mat.text || 'text-slate-800'} hover:bg-slate-800 hover:text-white outline-none transition-all font-bold`;
                if (window.lockedMaterialId === id) btn.classList.add('active', 'ring-2', 'ring-offset-2', 'ring-slate-400');
                btn.onmouseover = () => { if (!window.lockedMaterialId) window.updateMaterialUI(id); };
                btn.onmouseleave = () => { if (!window.lockedMaterialId) window.resetMaterialUI(); };
                btn.onclick = () => window.handleClick(id);
                btn.innerText = mat.title;
                btnContainer.appendChild(btn);
            });

            const picker = document.getElementById('theme-picker');
            if(picker) {
                picker.innerHTML = '';
                Object.keys(colorThemes).forEach(tKey => {
                    const dot = document.createElement('button');
                    dot.className = `w-6 h-6 rounded-full border-2 border-white shadow-sm hover:scale-110`;
                    dot.style.backgroundColor = colorThemes[tKey].borderColor;
                    dot.onclick = () => window.applyTheme(tKey);
                    picker.appendChild(dot);
                });
            }

            let headHtml = `<tr class="bg-slate-100 font-bold"><th class="p-3 border">Properties</th><th class="p-3 border">Unit</th>`;
            sortedIds.forEach(id => { headHtml += `<th class="p-3 border col-${id}">${catData[id].title}</th>`; });
            tableHead.innerHTML = headHtml + `</tr>`;

            const statsList = [{label:'ì ë„ (Viscosity)',unit:'cP',key:'visc'},{label:'íƒ„ì„±ê³„ìˆ˜ (E Modulus)',unit:'MPa',key:'modulus'},{label:'ì¸ì¥ê°•ë„ (Strength)',unit:'MPa',key:'strength'},{label:'ì—°ì‹ ìœ¨ (Elongation)',unit:'%',key:'elongation'},{label:'ì¶©ê²©ê°•ë„ (Impact)',unit:'J/m',key:'impact'},{label:'ê²½ë„ (Hardness)',unit:'D/A',key:'hardness'}];
            let bodyHtml = '';
            statsList.forEach((stat, i) => {
                bodyHtml += `<tr class="${i % 2 === 1 ? 'bg-slate-50' : ''} text-xs font-bold font-bold font-bold"><td class="p-3 border font-bold">${stat.label}</td><td class="p-3 border text-[10px]">${stat.unit}</td>`;
                sortedIds.forEach(id => {
                    bodyHtml += `<td class="p-3 border col-${id}">
                        <span class="value-display font-bold">${catData[id].stats[stat.key]}</span>
                        <input type="text" class="admin-only edit-input text-[10px] p-0 border-none bg-transparent" style="display:none" value="${catData[id].stats[stat.key]}" onchange="window.updateStatValue('${id}', '${stat.key}', this.value)">
                    </td>`;
                });
                bodyHtml += `</tr>`;
            });
            tableBody.innerHTML = bodyHtml;
            window.initChart();
        };

        window.initChart = () => {
            const ctxEl = document.getElementById('ssCurveChart');
            if (!ctxEl) return;
            const ctx = ctxEl.getContext('2d');
            const catData = window.resinData[window.currentCategory] || {};
            const sortedIds = Object.keys(catData).sort((a,b)=>catData[a].idx-catData[b].idx);
            const datasets = sortedIds.map(id => ({label: catData[id].title, borderColor: catData[id].borderColor, data: catData[id].chart || [], showLine: true, tension: 0.2, borderWidth: 3}));
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, { type: 'scatter', data: { datasets }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { min: 0, max: 300, title: { display: true, text: 'Strain (%)' } }, y: { min: 0, max: 100, title: { display: true, text: 'Stress (MPa)' } } }, plugins: { legend: { position: 'top', labels: { boxWidth: 10 } } } } });
        };

        window.handleClick = (id) => {
            if (window.lockedMaterialId === id) { window.lockedMaterialId = null; window.resetMaterialUI(); window.renderSystem(); }
            else { window.lockedMaterialId = id; window.renderSystem(); window.updateMaterialUI(id); }
        };

        window.updateMaterialUI = (id) => {
            const data = window.resinData[window.currentCategory][id];
            if(!data) return;
            const card = document.getElementById('detail-view');
            const defaultMsg = document.getElementById('default-msg');
            const activeContent = document.getElementById('active-content');
            if (!card || !defaultMsg || !activeContent) return;
            defaultMsg.classList.add('hidden');
            activeContent.classList.remove('hidden');
            card.className = `${data.color} p-6 rounded-2xl shadow-md border-t-8 ${data.border} min-h-[500px] flex flex-col justify-center overflow-y-auto`;
            ['title', 'tag', 'desc', 'features', 'apps'].forEach(f => {
                const el = document.getElementById(`mat-${f}-display`);
                if(el) el.innerText = f === 'desc' ? `"${data[f] || ''}"` : (data[f] || '');
                if (window.editMode) { const editEl = document.getElementById(`mat-${f}-edit`); if(editEl) editEl.value = data[f] || ""; }
            });
            const titleDisp = document.getElementById('mat-title-display');
            const tagDisp = document.getElementById('mat-tag-display');
            if(titleDisp) titleDisp.className = `text-2xl font-bold ${data.text}`;
            if(tagDisp) tagDisp.className = `${data.tagColor} text-slate-900 text-xs px-2 py-1 rounded-full font-bold`;
            if (window.editMode) {
                const zoomEdit = document.getElementById('mat-zoom-edit');
                const chartEdit = document.getElementById('mat-chart-edit');
                if(zoomEdit) zoomEdit.value = data.zoomMax || 300;
                if(chartEdit) chartEdit.value = JSON.stringify(data.chart || []);
                document.querySelectorAll('[id$="-edit"]').forEach(el => el.style.display = 'block');
                document.querySelectorAll('[id$="-display"]').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
            } else {
                document.querySelectorAll('[id$="-edit"]').forEach(el => el.style.display = 'none');
                document.querySelectorAll('[id$="-display"]').forEach(el => el.style.display = 'block');
                document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
            }
            document.querySelectorAll('#material-table td, #material-table th').forEach(el => el.classList.remove('bg-blue-100', 'bg-orange-100', 'bg-green-100', 'bg-yellow-100', 'bg-sky-100', 'bg-pink-100', 'font-bold'));
            if (window.lockedMaterialId === id) document.querySelectorAll(`.col-${id}`).forEach(el => el.classList.add(data.tableClass, 'font-bold'));
            if (window.myChart) {
                const keys = Object.keys(window.resinData[window.currentCategory]).sort((a,b)=>window.resinData[window.currentCategory][a].idx-window.resinData[window.currentCategory][b].idx);
                window.myChart.data.datasets.forEach((ds, i) => window.myChart.setDatasetVisibility(i, keys[i] === id));
                window.myChart.options.scales.x.max = data.zoomMax || 300;
                const zoomInd = document.getElementById('zoom-indicator');
                if(zoomInd) zoomInd.classList.toggle('hidden', (data.zoomMax || 300) >= 100);
                window.myChart.update(); 
            }
        };

        window.resetMaterialUI = () => {
            const elements = ['default-msg', 'active-content', 'zoom-indicator', 'detail-view'].map(id => document.getElementById(id));
            if (elements[0]) elements[0].classList.remove('hidden');
            if (elements[1]) elements[1].classList.add('hidden');
            if (elements[2]) elements[2].classList.add('hidden');
            if (elements[3]) elements[3].className = `bg-slate-100 p-8 rounded-2xl shadow-md border-t-8 border-slate-300 h-[430px] flex flex-col justify-center font-bold`;
            document.querySelectorAll('#material-table td, #material-table th').forEach(el => el.classList.remove('font-bold', 'bg-blue-100', 'bg-orange-100', 'bg-green-100', 'bg-yellow-100', 'bg-sky-100', 'bg-pink-100'));
            if (window.myChart) { window.myChart.data.datasets.forEach((ds, i) => window.myChart.setDatasetVisibility(i, true)); window.myChart.options.scales.x.max = 300; window.myChart.update(); }
            document.querySelectorAll('.material-btn').forEach(b => b.classList.remove('active', 'ring-2', 'ring-offset-2', 'ring-slate-400'));
        };

        window.switchCategory = (cat) => {
            window.currentCategory = cat; window.lockedMaterialId = null;
            document.querySelectorAll('.category-tab').forEach(t => { t.classList.remove('active'); t.classList.add('text-slate-500'); });
            const activeTab = document.getElementById(`tab-${cat}`);
            if(activeTab) { activeTab.classList.add('active'); activeTab.classList.remove('text-slate-500'); }
            window.renderSystem(); window.resetMaterialUI();
        };

        window.verifyPassword = () => { if (document.getElementById('pw-input').value === '028877') { window.setEditMode(true); window.closePwModal(); } else { window.showMessage("ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼"); } };
        window.setEditMode = (active) => {
            window.editMode = active;
            const btn = document.getElementById('edit-mode-btn');
            if(btn) { btn.innerText = active ? "âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ ON" : "âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ OFF"; btn.className = active ? "bg-indigo-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg" : "bg-slate-200 text-slate-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-slate-300 transition-colors"; }
            document.body.classList.toggle('edit-mode-active', active);
            if (window.lockedMaterialId) window.updateMaterialUI(window.lockedMaterialId);
            window.renderSystem();
        };

        window.autoSaveCurrentMaterial = () => {
            const id = window.lockedMaterialId; if (!id) return;
            const data = window.resinData[window.currentCategory][id];
            data.title = document.getElementById('mat-title-edit').value;
            data.tag = document.getElementById('mat-tag-edit').value;
            data.desc = document.getElementById('mat-desc-edit').value;
            data.features = document.getElementById('mat-features-edit').value;
            data.apps = document.getElementById('mat-apps-edit').value;
            data.zoomMax = parseFloat(document.getElementById('mat-zoom-edit').value) || 300;
            try { data.chart = JSON.parse(document.getElementById('mat-chart-edit').value); } catch(e) {}
            window.saveToFirestore();
        };

        window.toggleEditMode = () => { if (window.editMode) window.setEditMode(false); else document.getElementById('pw-modal').classList.remove('hidden'); };
        window.closePwModal = () => { const el = document.getElementById('pw-modal'); if(el) el.classList.add('hidden'); };
        window.updateStatValue = (id, key, val) => { window.resinData[window.currentCategory][id].stats[key] = val; window.saveToFirestore(); };
        window.addMaterial = () => { 
            const nid = 'new_' + Date.now(); 
            window.resinData[window.currentCategory][nid] = { idx: Object.keys(window.resinData[window.currentCategory]).length, zoomMax: 50, title: 'ìƒˆ ë ˆì§„', tag: 'ì‹ ê·œ', ...colorThemes.slate, stats: { visc: '0', modulus: '0', strength: '0', elongation: '0', impact: '0', hardness: '0' }, chart: [{x:0, y:0}, {x:5, y:25}], features:'íŠ¹ì§• ì…ë ¥', apps:'ìš©ë„ ì…ë ¥' }; 
            window.saveToFirestore(); 
        };
        window.deleteMaterial = () => { if (confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { delete window.resinData[window.currentCategory][window.lockedMaterialId]; window.lockedMaterialId = null; window.saveToFirestore(); window.resetMaterialUI(); window.renderSystem(); } };
        window.showMessage = (txt) => { const box = document.getElementById('msg-box'); if(box) { box.innerText = txt; box.classList.remove('hidden'); setTimeout(() => box.classList.add('hidden'), 2000); } };
        window.applyTheme = (tKey) => { const id = window.lockedMaterialId; if (!id) return; Object.assign(window.resinData[window.currentCategory][id], colorThemes[tKey]); window.saveToFirestore(); window.updateMaterialUI(id); };

        document.addEventListener('DOMContentLoaded', () => {
            const pwInput = document.getElementById('pw-input');
            if (pwInput) pwInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') window.verifyPassword(); });
            if (window.currentUser) window.loadResinData();
        });
    </script>
    <style>.font-bold { font-weight: 700 !important; }</style>
</head>
<body class="bg-slate-50 text-slate-900 p-4 md:p-8">
    <div class="max-w-6xl mx-auto font-bold">
        <header class="mb-6 text-center relative font-bold">
            <div class="absolute right-0 top-0"><button onclick="toggleEditMode()" id="edit-mode-btn" class="bg-slate-200 text-slate-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-slate-300 transition-colors font-bold">âš™ï¸ ê´€ë¦¬ì ëª¨ë“œ OFF</button></div>
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-6 font-bold">ìºë¦¬ë§ˆí… ë ˆì§„ ë¬¼ì„± ê°€ì´ë“œ</h1>
            <div class="inline-flex p-1 bg-slate-200 rounded-xl mb-6 font-bold">
                <button onclick="switchCategory('engineering')" id="tab-engineering" class="category-tab active px-5 py-2 rounded-lg text-sm font-bold transition-all">Engineering ë ˆì§„</button>
                <button onclick="switchCategory('functional')" id="tab-functional" class="category-tab px-5 py-2 rounded-lg text-sm font-bold text-slate-500 transition-all">Functional ë ˆì§„</button>
                <button onclick="switchCategory('general')" id="tab-general" class="category-tab px-5 py-2 rounded-lg text-sm font-bold text-slate-500 transition-all">General ë ˆì§„</button>
            </div>
            <p class="text-slate-500 text-base font-medium font-bold">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  ì†Œì¬ë¥¼ <b>í´ë¦­</b>í•˜ì—¬ ê·¸ë˜í”„ í™•ëŒ€ ë° ìƒì„¸ í”„ë¡œí•„ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        </header>

        <div id="msg-box" class="fixed top-4 left-1/2 -translate-x-1/2 z-[110] hidden bg-slate-800 text-white px-6 py-3 rounded-xl shadow-2xl transition-all font-bold"></div>

        <div id="pw-modal" class="modal-overlay hidden font-bold">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-80 text-center font-bold">
                <h3 class="font-bold text-lg mb-4 text-slate-800 font-bold">ê´€ë¦¬ì ì¸ì¦</h3>
                <p class="text-xs text-slate-500 mb-4 font-bold">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>
                <input type="password" id="pw-input" class="w-full p-3 border border-slate-200 rounded-xl mb-4 text-center focus:outline-none focus:ring-2 focus:ring-indigo-500 font-bold" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
                <div class="flex gap-2 font-bold">
                    <button onclick="closePwModal()" class="flex-1 py-2 text-slate-500 font-bold hover:bg-slate-50 rounded-lg font-bold">ì·¨ì†Œ</button>
                    <button onclick="verifyPassword()" class="flex-1 py-2 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 font-bold font-bold">í™•ì¸</button>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8 font-bold">
            <div class="lg:col-span-7 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 relative text-left">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold flex items-center gap-2 font-bold font-bold">ğŸ“ˆ Stress-Strain Curve</h2>
                        <div id="zoom-indicator" class="hidden zoom-badge bg-indigo-100 text-indigo-700 text-[10px] px-2 py-1 rounded-full font-bold">ğŸ” ìŠ¤ì¼€ì¼ ìµœì í™” ëª¨ë“œ (Zoomed)</div>
                    </div>
                    <div class="relative h-[400px] w-full"><canvas id="ssCurveChart"></canvas></div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-center text-xs">
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-slate-600 mb-1 text-xs font-bold">Viscosity</h3><p class="text-slate-500 font-medium font-bold">íë¦„ì„± = ì¶œë ¥ í¸ì˜ì„±</p></div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-blue-600 mb-1 text-xs font-bold font-bold">E Modulus</h3><p class="text-slate-500 font-medium font-bold font-bold">ê¸°ìš¸ê¸° = ë”±ë”±í•¨(ê°•ì„±)</p></div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-red-600 mb-1 text-xs font-bold font-bold font-bold">Tensile Strength</h3><p class="text-slate-500 font-medium font-bold font-bold font-bold">ë†’ì´ = ìµœëŒ€ í˜(ê°•ë„)</p></div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-green-600 mb-1 text-xs font-bold font-bold font-bold">Elongation</h3><p class="text-slate-500 font-medium font-bold font-bold font-bold font-bold">ê°€ë¡œ ê¸¸ì´ = ëŠ˜ì–´ë‚¨</p></div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-orange-600 mb-1 text-xs font-bold font-bold font-bold font-bold">Impact Strength</h3><p class="text-slate-500 font-medium font-bold font-bold font-bold font-bold">ì¶©ê²© ì €í•­ì„±</p></div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center"><h3 class="text-purple-600 mb-1 text-xs font-bold font-bold font-bold font-bold">Shore Hardness</h3><p class="text-slate-500 font-medium font-bold font-bold font-bold font-bold font-bold">í‘œë©´ ë‹¨ë‹¨í•¨ (A/D)</p></div>
                </div>
            </div>
            <div class="lg:col-span-5 space-y-4 text-left font-bold">
                <div class="flex justify-between items-center h-8 font-bold font-bold"><h2 class="text-xl font-bold text-slate-700">ğŸ” ì†Œì¬ë³„ ìƒì„¸ í”„ë¡œí•„</h2><button onclick="addMaterial()" class="admin-only bg-indigo-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-indigo-700">ì†Œì¬ ì¶”ê°€ +</button></div>
                <div id="material-btns-container" class="grid grid-cols-3 gap-2 font-bold font-bold"></div>
                <div id="detail-view" class="bg-slate-100 p-6 rounded-2xl shadow-md border-t-8 border-slate-300 min-h-[500px] flex flex-col justify-center overflow-y-auto font-bold font-bold">
                    <div id="material-content">
                        <div id="default-msg" class="text-center font-bold font-bold font-bold font-bold"><p class="text-slate-400 font-medium italic">ì†Œì¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p></div>
                        <div id="active-content" class="hidden space-y-4 font-bold font-bold">
                            <div class="admin-only space-y-2 mb-4 p-3 bg-white/50 rounded-xl border border-slate-200 font-bold font-bold" style="display:none">
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider font-bold">ì†Œì¬ í…Œë§ˆ ë° ìŠ¤ì¼€ì¼</label>
                                <div id="theme-picker" class="flex flex-wrap gap-2 mb-2 font-bold"></div>
                                <div class="flex items-center gap-2 bg-white p-2 rounded-lg font-bold"><span class="text-[10px] text-slate-500 font-bold font-bold font-bold">Zoom Max (%):</span><input type="number" id="mat-zoom-edit" class="edit-input w-16 text-xs font-bold" onchange="autoSaveCurrentMaterial()"></div>
                            </div>
                            <div class="space-y-2 font-bold">
                                <div class="flex items-center gap-3">
                                    <h3 id="mat-title-display" class="text-2xl font-bold font-bold font-bold">ì†Œì¬ëª…</h3>
                                    <input id="mat-title-edit" class="admin-only edit-input text-xl font-bold font-bold" style="display:none" onchange="autoSaveCurrentMaterial()">
                                    <span id="mat-tag-display" class="text-xs px-2 py-1 rounded-full font-bold font-bold">íƒœê·¸</span>
                                    <input id="mat-tag-edit" class="admin-only edit-input text-xs w-24 font-bold" style="display:none" onchange="autoSaveCurrentMaterial()">
                                </div>
                                <div class="space-y-1 font-bold font-bold">
                                    <p id="mat-desc-display" class="text-base text-slate-700 font-semibold italic font-bold">"ì„¤ëª…"</p>
                                    <textarea id="mat-desc-edit" class="admin-only edit-input italic" rows="2" style="display:none" onchange="autoSaveCurrentMaterial()"></textarea>
                                </div>
                            </div>
                            <div class="space-y-4 font-bold font-bold font-bold font-bold">
                                <div><h4 class="text-sm font-bold text-slate-900 mb-1 font-bold">ğŸ’¡ ì£¼ìš” íŠ¹ì§•</h4><p id="mat-features-display" class="text-sm text-slate-600 leading-relaxed whitespace-pre-line font-medium"></p><textarea id="mat-features-edit" class="admin-only edit-input text-sm" rows="4" style="display:none" onchange="autoSaveCurrentMaterial()"></textarea></div>
                                <div><h4 class="text-sm font-bold text-slate-900 mb-1 font-bold">ğŸš€ ì¶”ì²œ ì–´í”Œë¦¬ì¼€ì´ì…˜</h4><p id="mat-apps-display" class="text-sm text-slate-600 leading-relaxed font-medium font-bold"></p><textarea id="mat-apps-edit" class="admin-only edit-input text-sm" rows="3" style="display:none" onchange="autoSaveCurrentMaterial()"></textarea></div>
                                <div class="admin-only" style="display:none"><h4 class="text-sm font-bold text-red-600 font-bold">ğŸ“ˆ ê·¸ë˜í”„ í¬ì¸íŠ¸ (JSON)</h4><textarea id="mat-chart-edit" class="edit-input font-mono text-[10px]" rows="3" onchange="autoSaveCurrentMaterial()"></textarea></div>
                            </div>
                            <div class="admin-only pt-4 border-t border-slate-200" style="display:none"><button onclick="deleteMaterial()" class="w-full bg-red-50 text-red-600 py-2 rounded-lg font-bold hover:bg-red-100 border border-red-200 transition-colors font-bold font-bold">ì†Œì¬ ì‚­ì œ</button></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="overflow-x-auto bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-8 font-bold font-bold font-bold"><h2 class="text-xl font-bold mb-4 text-slate-700 font-bold font-bold font-bold">ğŸ“Š ìƒì„¸ ë¬¼ì„± ë°ì´í„° ë¹„êµ</h2><table class="w-full text-left border-collapse text-xs md:text-sm font-bold font-bold" id="material-table"><thead id="table-head"></thead><tbody id="table-body"></tbody></table></div>
        <footer class="mt-12 text-center text-slate-400 text-sm pb-8 border-t border-slate-200 pt-8 font-medium font-bold font-bold">Â© 2024 ìºë¦¬ë§ˆí… ë ˆì§„ ë¬¼ì„± ê°€ì´ë“œ | íŠ¹ì§• ë° ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë³µêµ¬ ì™„ë£Œ</footer>
    </div>
</body>
</html>
